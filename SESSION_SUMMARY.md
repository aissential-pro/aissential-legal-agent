# Session de Maintenance - 3 FÃ©vrier 2026

## Vue d'ensemble du Bot

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ¤– BOT LEGAL AGENT                           â”‚
â”‚                   (@aissential_legal_bot)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   COMMANDES   â”‚    â”‚  AUTOMATIQUE  â”‚    â”‚   FICHIERS    â”‚
â”‚  INTERACTIVES â”‚    â”‚  (SCHEDULED)  â”‚    â”‚   ENVOYÃ‰S     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                     â”‚                     â”‚
        â–¼                     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /ping         â”‚    â”‚ 7h00: Heartbeatâ”‚    â”‚ PDF â†’ Analyse â”‚
â”‚ Test rapide   â”‚    â”‚ Status du bot â”‚    â”‚ automatique   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚ du contrat    â”‚
â”‚ /health       â”‚    â”‚ 8h00: Veille  â”‚    â”‚               â”‚
â”‚ Diagnostic    â”‚    â”‚ juridique     â”‚    â”‚ DOCX â†’ Analyseâ”‚
â”‚ complet       â”‚    â”‚ Vietnam       â”‚    â”‚ automatique   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚ du contrat    â”‚
â”‚ /status       â”‚    â”‚ 9h00: Check   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ Statistiques  â”‚    â”‚ expirations   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚ contrats      â”‚
â”‚ /veille       â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ Veille juridique
â”‚ Vietnam (manuel)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ /scan         â”‚
â”‚ Scanner Googleâ”‚
â”‚ Drive         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ /expirations  â”‚
â”‚ Contrats qui  â”‚
â”‚ expirent      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ANALYSE DE CONTRATS                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Identification des parties                                    â”‚
â”‚ â€¢ Dates clÃ©s (signature, dÃ©but, fin, renouvellement)           â”‚
â”‚ â€¢ Clauses Ã  risque (pÃ©nalitÃ©s, exclusivitÃ©, rÃ©siliation)       â”‚
â”‚ â€¢ ConformitÃ© Vietnam (droit du travail, Ã©trangers)             â”‚
â”‚ â€¢ Score de risque (0-100) avec alertes si > 60                 â”‚
â”‚ â€¢ Recommandations juridiques                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      VEILLE JURIDIQUE                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Domaines surveillÃ©s:                                            â”‚
â”‚ â€¢ ğŸ‘¤ Ã‰trangers au Vietnam (work permits, visas, ownership)     â”‚
â”‚ â€¢ ğŸ¢ Lois SME/Entreprises (licences, immatriculation)          â”‚
â”‚ â€¢ ğŸ¤– RÃ©glementation IA/Tech                                     â”‚
â”‚ â€¢ ğŸ›ï¸ Projets de loi AssemblÃ©e nationale (Quá»‘c há»™i)             â”‚
â”‚                                                                 â”‚
â”‚ Scoring d'impact:                                               â”‚
â”‚ ğŸ”´ 90-100 CRITIQUE â†’ Action immÃ©diate                          â”‚
â”‚ ğŸŸ  70-89  Ã‰LEVÃ‰    â†’ Action sous 30 jours                      â”‚
â”‚ ğŸŸ¡ 40-69  MODÃ‰RÃ‰   â†’ Ã€ surveiller                              â”‚
â”‚ ğŸŸ¢ 0-39   FAIBLE   â†’ Information                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      INTÃ‰GRATIONS                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ Google Drive    â”‚ Scan rÃ©cursif de 3 dossiers              â”‚
â”‚                    â”‚ (clients, travail, fournisseurs)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ¤– OpenAI          â”‚ GPT-4o-mini (analyse rapide)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ’¬ Telegram        â”‚ Alertes + commandes (privÃ© & groupe)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FIABILITÃ‰                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… Retry automatique avec backoff sur erreurs API              â”‚
â”‚ âœ… Supervisor avec restart auto si crash                       â”‚
â”‚ âœ… Logs rotatifs (10 MB max)                                   â”‚
â”‚ âœ… Persistance robuste avec backup                             â”‚
â”‚ âœ… DÃ©ployÃ© sur VPS (pm2) - 72.60.104.129                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**En rÃ©sumÃ©:** C'est votre CLO (Chief Legal Officer) virtuel qui surveille vos contrats et la lÃ©gislation vietnamienne 24/7.

---

## ProblÃ¨mes rÃ©solus

### 1. FiabilitÃ© du bot (crash frÃ©quents)
- **AjoutÃ©:** Supervisor avec restart automatique (`app/supervisor.py`)
- **AjoutÃ©:** Retry avec exponential backoff pour les appels API
- **AjoutÃ©:** Health check (`/health`) et heartbeat quotidien Ã  7h00
- **AjoutÃ©:** Logs rotatifs (10 MB max)
- **AjoutÃ©:** Persistance robuste avec backup automatique

### 2. Lenteur de /veille (15 min â†’ 15 sec)
- **ChangÃ©:** GPT-4o â†’ GPT-4o-mini (10x plus rapide)
- **RÃ©duit:** Prompt de 160 lignes â†’ 30 lignes
- **SupprimÃ©:** Recherches web DuckDuckGo (souvent bloquÃ©es)

### 3. Bot ne rÃ©pondait pas en privÃ©
- **Cause:** Multiples instances en conflit
- **Solution:** Tuer toutes les instances et relancer UNE seule

---

## Fichiers crÃ©Ã©s/modifiÃ©s

| Fichier | Description |
|---------|-------------|
| `app/supervisor.py` | Supervision avec restart auto + alertes Telegram |
| `app/utils/reliability.py` | DÃ©corateurs retry avec backoff |
| `app/utils/logging_config.py` | Configuration logs rotatifs |
| `app/memory/processed_files.py` | Persistance robuste avec backup |
| `start_bot.bat` | Script de dÃ©marrage Windows |
| `start_bot.ps1` | Script PowerShell |
| `install_service.ps1` | Installation comme service Windows |
| `RELIABILITY.md` | Guide de maintenance complet |

---

## Comment lancer le bot

### Mode simple (dÃ©veloppement)
```
Double-cliquez sur: C:\Users\franc\projects\aissential-legal-agent\start_bot.bat
```

### Mode production (avec supervision)
```cmd
cd C:\Users\franc\projects\aissential-legal-agent
venv\Scripts\python.exe app\supervisor.py
```

### Comme service Windows (dÃ©marrage auto)
```powershell
# En administrateur
.\install_service.ps1
```

---

## Commandes Telegram

| Commande | Description |
|----------|-------------|
| `/ping` | Test rapide |
| `/health` | Diagnostic complet (nouveau) |
| `/status` | Statistiques |
| `/veille` | Veille juridique Vietnam |
| `/scan` | Scanner Google Drive |
| `/expirations` | Contrats qui expirent |

---

## Heartbeat automatique

Le bot envoie un message de statut **chaque jour Ã  7h00 (heure Vietnam)** avec:
- Uptime
- Utilisation mÃ©moire du PC
- Nombre de fichiers analysÃ©s
- Nombre d'erreurs

**Note:** "MÃ©moire 85%" = RAM totale du VPS, pas du bot.

---

## DÃ©ploiement VPS Production

| Info | Valeur |
|------|--------|
| **IP** | 72.60.104.129 |
| **User** | frawan |
| **Path** | `/home/frawan/aissential-legal-agent` |
| **Process Manager** | pm2 (name: `legal-agent`) |

### Connexion SSH
```bash
ssh -i C:\Users\franc\.ssh\id_ed25519_vps_francis_hcm frawan@72.60.104.129
```

### Commandes pm2 (sur VPS)
```bash
pm2 status              # Voir status
pm2 logs legal-agent    # Voir logs
pm2 restart legal-agent # RedÃ©marrer
```

---

## En cas de problÃ¨me

1. **Bot ne rÃ©pond pas:** VÃ©rifier qu'une seule instance tourne
   ```cmd
   tasklist | findstr python
   ```

2. **Multiples instances:** Tout tuer et relancer
   ```cmd
   taskkill /F /IM python.exe
   start_bot.bat
   ```

3. **Logs:** `C:\Users\franc\projects\aissential-legal-agent\logs\app.log`

---

## Git commits effectuÃ©s

1. `feat: Add reliability improvements for 99%+ uptime`
2. `perf: Optimize /veille command for 10x faster response`
3. `docs: Add VPS deployment info to CONTEXT.md`
4. `chore: Schedule heartbeat daily at 7:00 AM Vietnam time`

Repo: https://github.com/aissential-pro/aissential-legal-agent
